"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const got_1 = __importDefault(require("got"));
const keyv_1 = __importDefault(require("keyv"));
const keyv_file_1 = __importDefault(require("keyv-file"));
const probe_image_size_1 = __importDefault(require("probe-image-size"));
const keyv = new keyv_1.default({
    store: new keyv_file_1.default({
        expiredCheckDelay: 0,
        filename: './cache/keyv-file.json'
    })
});
async function fetchImageSize(URL, repo) {
    let dataInCache = await keyv.get(URL);
    if (dataInCache != null) {
        console.log(`[FromCache] Image: ${URL}`);
        return dataInCache;
    }
    let size;
    try {
        let result = await (0, probe_image_size_1.default)(URL);
        size = [result.width, result.height];
    }
    catch (err) {
        console.log(`[FetchImageSize] error. image: ${URL} , repo: ${repo} , error: ${err}`);
        size = [0, 0];
    }
    let saved = await keyv.set(URL, size, 365 * 24 * 60 * 60); // 1 year
    if (!saved) {
        throw '[Internal] saved error';
    }
    return size;
}
async function httpGet(URL) {
    try {
        let response = await (0, got_1.default)(URL, {
            headers: {
                "Authorization": "Basic dXNlcm5hbWU6Z2hwX21qd2hFeFNNaFVTTEpPMHJsNVQycXM4TzJMTkVacDNoMDBubA=="
            }
        });
        console.log(`[${response.headers['x-ratelimit-remaining']}] Got: ${URL}`);
        return JSON.parse(response.body);
    }
    catch (error) {
        throw `[API] eror! URL: ${URL} , error: ${error}`;
    }
}
// seconds
function cacheExpiry(repoData) {
    let update = (new Date(repoData['pushed_at'])).getTime();
    let now = Date.now();
    let months = (now - update) / 1000 / 60 / 60 / 24 / 30;
    if (months < 1) {
        return 1 * 24 * 60 * 60; // 1 day
    }
    else if (months < 12) {
        return 30 * 24 * 60 * 60; // 30 day
    }
    else if (months < 24) {
        return 365 / 2 * 24 * 60 * 60; // half year
    }
    else {
        return 365 * 24 * 60 * 60; // 1 year
    }
}
async function getFromCache(key) {
    let dataInCache = await keyv.get(key);
    if (dataInCache != null) {
        console.log(`[FromCache] Got: ${key}`);
        return dataInCache;
    }
    return null;
}
async function cache(key, value, repoData) {
    let seconds = cacheExpiry(repoData);
    let saved = await keyv.set(key, value, seconds * 1000);
    if (!saved) {
        throw '[Internal] saved error';
    }
    console.log(`[SaveCache][${seconds / 60 / 60 / 24}] ${key}`);
}
async function repoAPI(user, repoName) {
    let URL = `https://api.github.com/repos/${user}/${repoName}`;
    let dataInCache = await getFromCache(URL);
    if (dataInCache != null) {
        return dataInCache;
    }
    let data = await httpGet(URL);
    await cache(URL, data, data);
    return data;
}
async function repoReadmeAPI(user, repoName, repoData) {
    let URL = `https://api.github.com/repos/${user}/${repoName}/readme`;
    let dataInCache = await getFromCache(URL);
    if (dataInCache != null) {
        return dataInCache;
    }
    let data;
    try {
        data = await httpGet(URL);
    }
    catch (error) {
        console.log(`[API] Readme API error: ${error}`);
        data = null;
    }
    if (data != null) {
        await cache(URL, data, repoData);
        return data;
    }
    else {
        return null;
    }
}
async function fetchRepo(URL) {
    const repoURLRegExp = RegExp('^https:\/\/github\.com\/(.+?)\/(.+?)$');
    var match = URL.match(repoURLRegExp);
    if (match == null || match.length != 3) {
        throw `[Internal] URL is wrong ${URL}`;
    }
    let user = match[1];
    let repoName = match[2];
    let repoData = await repoAPI(user, repoName);
    let readmeData = await repoReadmeAPI(user, repoName, repoData);
    let readmeContent = readmeData == null ? "" : Buffer.from(readmeData['content'], 'base64').toString('utf8');
    // get images
    var imageURLs = [];
    const markdownImageRegExp = RegExp(/!\[[^\]]*\]\((?<filename>.*?)(?=\"|\))(?<optionalpart>\".*\")?\)/gm);
    match = markdownImageRegExp.exec(readmeContent);
    while (match != null) {
        let imageURL = match[1].trim();
        imageURLs.push(imageURL);
        match = markdownImageRegExp.exec(readmeContent);
    }
    const htmlImageRegExp = RegExp(/<img[^>]+src *= *["|']([^">']+)["|']/gm);
    match = htmlImageRegExp.exec(readmeContent);
    while (match != null) {
        let imageURL = match[1].trim();
        imageURLs.push(imageURL);
        match = htmlImageRegExp.exec(readmeContent);
    }
    // convert
    imageURLs = imageURLs.map(imageURL => {
        let originalURL = imageURL;
        if (!imageURL.startsWith('http')) {
            let htmlURL = readmeData['html_url'];
            const masterBranchRegExp = RegExp(/\/blob\/([^\/]+?)\/[^\/]+$/);
            let matched = htmlURL.match(masterBranchRegExp);
            if (matched == null || matched.length != 2) {
                throw `[Internal] htmlURL is wrong ${htmlURL}`;
            }
            let branchName = matched[1];
            imageURL = `https://github.com/${user}/${repoName}/raw/${branchName}${imageURL.startsWith('/') ? '' : '/'}` + imageURL;
        }
        const regExpURLTransferBlobToRaw = RegExp(/(https:\/\/github\.com\/.*?\/.*?\/)blob/);
        if (imageURL.match(regExpURLTransferBlobToRaw)) {
            imageURL = imageURL.replace(regExpURLTransferBlobToRaw, "$1raw");
        }
        imageURL = encodeURI(imageURL);
        if (originalURL != imageURL) {
            console.log(`[Image Transfer] Change image URL from ${originalURL} to ${imageURL}`);
        }
        return imageURL;
    });
    // size sort
    var imagesURLAndSize = await Promise.all(imageURLs.map(imageURL => fetchImageSize(imageURL, URL).then(size => [imageURL, size])));
    imagesURLAndSize = imagesURLAndSize.filter(e => e[1][0] > 50 && e[1][1] > 50);
    imagesURLAndSize.sort((a, b) => {
        return b[1][0] * b[1][1] - a[1][0] * a[1][1];
    });
    // model
    let images = imagesURLAndSize.slice(0, 3).map(e => e[0]);
    let repo = {
        user: repoData['owner']['login'],
        name: repoData['name'],
        about: repoData['description'],
        stars: repoData['stargazers_count'],
        tags: repoData['topics'],
        images: images
    };
    return repo;
}
async function generateCategories(categoryConfigs) {
    var categories = [];
    for (let categoryConfig of categoryConfigs) {
        var repos = [];
        for (const URL of categoryConfig.repos) {
            let repo = await fetchRepo(URL);
            repos.push(repo);
        }
        repos = repos.sort(function (a, b) {
            return b.stars - a.stars;
        });
        var category = {
            name: categoryConfig.category,
            repos: repos
        };
        categories.push(category);
    }
    return categories;
}
function getMarkdownWithRepo(repo) {
    let markdown = "";
    // name
    markdown += `### [${repo.name}](https://github.com/${repo.user}/${repo.name})\n\n`;
    // stars and tags
    let starsAndTags = `stars: ${nFormatter(repo.stars, 1)}`;
    if (repo.tags.length > 0) {
        starsAndTags += `    <${repo.tags.join(', ')}>`;
    }
    markdown += starsAndTags + '\n\n';
    // about
    if (repo.about) {
        markdown += `> ${repo.about}\n\n`;
    }
    // image
    if (repo.images.length > 0) {
        markdown += '<details>\n<summary>Click to see images</summary>' + '\n\n';
        repo.images.forEach(imageURL => {
            // image lazy load
            markdown += `<p><img data-src="${imageURL}" class="lazyload"></p>\n\n`;
            // markdown += `![](${imageURL})`
        });
        markdown += '</details>' + '\n\n';
    }
    return markdown;
}
function nFormatter(num, digits) {
    const lookup = [
        { value: 1, symbol: "" },
        { value: 1e3, symbol: "k" },
        { value: 1e6, symbol: "M" },
        { value: 1e9, symbol: "G" },
        { value: 1e12, symbol: "T" },
        { value: 1e15, symbol: "P" },
        { value: 1e18, symbol: "E" }
    ];
    const rx = /\.0+$|(\.[0-9]*[1-9])0+$/;
    var item = lookup.slice().reverse().find(function (item) {
        return num >= item.value;
    });
    return item ? (num / item.value).toFixed(digits).replace(rx, "$1") + item.symbol : "0";
}
function getMarkdownWithCategory(category) {
    let markdown = "";
    markdown += `## ${category.name}\n\n`;
    category.repos.forEach(repo => {
        markdown += getMarkdownWithRepo(repo) + '\n\n';
    });
    return markdown;
}
function getMarkdownWithCategories(categories) {
    let markdown = "";
    categories.forEach(category => {
        markdown += getMarkdownWithCategory(category) + '\n\n';
    });
    return markdown;
}
hexo.extend.renderer.register('github', 'html', async function (data, options) {
    try {
        let json = data.text.replace(/---.*?---/s, "");
        let categoryConfigs = JSON.parse(json);
        let categories = await generateCategories(categoryConfigs);
        let markdown = getMarkdownWithCategories(categories);
        let htmlPromise = hexo.extend.renderer.get('md').call(hexo, {
            text: markdown,
            path: data.path
        }, options);
        let html = await htmlPromise;
        // image lazy load
        html = '<script src="https://afarkas.github.io/lazysizes/lazysizes.min.js" async=""></script>\n' + html;
        console.log(`Done!`);
        return html;
    }
    catch (error) {
        console.log(`[Internal] exit: ${error}`);
        process.exit(1);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGV4by1yZW5kZXJlci1naXRodWIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zb3VyY2UvaGV4by1yZW5kZXJlci1naXRodWIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw4Q0FBc0I7QUFDdEIsZ0RBQXdCO0FBQ3hCLDBEQUFpQztBQUNqQyx3RUFBb0M7QUFxQnBDLE1BQU0sSUFBSSxHQUFHLElBQUksY0FBSSxDQUFDO0lBQ2xCLEtBQUssRUFBRSxJQUFJLG1CQUFRLENBQUM7UUFDaEIsaUJBQWlCLEVBQUUsQ0FBQztRQUNwQixRQUFRLEVBQUUsd0JBQXdCO0tBQ3JDLENBQUM7Q0FDTCxDQUFDLENBQUE7QUFFRixLQUFLLFVBQVUsY0FBYyxDQUFDLEdBQVcsRUFBRSxJQUFZO0lBQ25ELElBQUksV0FBVyxHQUFHLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQTRCLENBQUE7SUFDaEUsSUFBSSxXQUFXLElBQUksSUFBSSxFQUFFO1FBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDekMsT0FBTyxXQUFXLENBQUE7S0FDckI7SUFDRCxJQUFJLElBQXNCLENBQUE7SUFDMUIsSUFBSTtRQUNBLElBQUksTUFBTSxHQUFHLE1BQU0sSUFBQSwwQkFBSyxFQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQzdCLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0tBQ3ZDO0lBQUMsT0FBTyxHQUFHLEVBQUU7UUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLGtDQUFrQyxHQUFHLFlBQVksSUFBSSxhQUFhLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDckYsSUFBSSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0tBQ2hCO0lBQ0QsSUFBSSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFB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